import {Input} from '@chakra-ui/react'
import Head from 'next/head'
import {useEffect, useState} from 'react'
import ButtonComponent from '../src/components/ButtonComponent'
import EventCard from '../src/components/EventCard'
import styles from '../styles/Home.module.css'

export default function Home() {
	const [name, setName] = useState('')
	const [city, setCity] = useState('')
	const [events, setEvents] = useState([])
	function handleNameChange(e) {
		setName(e.target.value)
	}
	function handleCityChange(e) {
		setCity(e.target.value)
	}
	async function handleClick() {
		await fetchEvent(name)
	}
	async function fetchEvent() {
		// setName(e.target.value)
		const url =
			name.length > 0
				? `https://app.ticketmaster.com/discovery/v2/events.json?size=10&keyword=${name}&apikey=${process.env.NEXT_PUBLIC_API_KEY}&locale=en-gb`
				: city.length > 0
				? `https://app.ticketmaster.com/discovery/v2/events.json?size=10&keyword=${name}&city=${city}&apikey=${process.env.NEXT_PUBLIC_API_KEY}&locale=en-gb`
				: `https://app.ticketmaster.com/discovery/v2/events.json?size=10&apikey=${process.env.NEXT_PUBLIC_API_KEY}&locale=en-gb&countryCode=GB`
		const response = await fetch(url)
		const data = await response.json()
		console.log('single data: ', data)

		setEvents(data._embedded.events.slice(0, 10))
	}
	useEffect(() => {
		async function fetchEvents() {
			const response = await fetch(
				`https://app.ticketmaster.com/discovery/v2/events.json?size=10&keyword=${name}&apikey=${process.env.NEXT_PUBLIC_API_KEY}&countryCode=GB`
			)
			const data = await response.json()
			console.log('events data: ', data)
			setEvents(data)
		}
		fetchEvents()
		// console.log('name: ', name)
	}, [])
	return (
		<div className={styles.container}>
			<Head>
				<title>Event Finder</title>
				<meta name='description' content='Generated by create next app' />
				<link rel='icon' href='/favicon.ico' />
			</Head>

			<main className={styles.main}>
				<h1 className={styles.title}> Event Finder</h1>
				<Input
					onChange={handleNameChange}
					type='text'
					size='sm'
					variant='filled'
					placeholder='Event ...'
					width='30%'
				/>
				<Input
					onChange={handleCityChange}
					type='text'
					size='sm'
					variant='filled'
					placeholder='City...'
					width='30%'
				/>
				<ButtonComponent
					colorScheme='teal'
					size='sm'
					handleClick={e => {
						handleClick(e)
					}}
					text='Search Event'
				/>
				{events.length > 0 &&
					events.map(event => {
						return <EventCard key={event.id} event={event} />
					})}
			</main>
		</div>
	)
}
